// ==UserScript==
// @name                ChatGPT Widescreen Mode 🖥️
// @name:af             ChatGPT Widescreen Modus 🖥️
// @name:am             ቻትጂፒቲ ሰፊ ስክሪን 🖥️
// @name:ar             ChatGPT وضع شاشة عريضة 🖥️
// @name:az             ChatGPT Geniş Ekran Rejimi 🖥️
// @name:be             ChatGPT Рэжым шырокага экрана 🖥️
// @name:bem            ChatGPT Icikope Icakulisha 🖥️
// @name:bg             ChatGPT Широкоекранен режим 🖥️
// @name:bn             ChatGPT উইডস্ক্রিন মোড 🖥️
// @name:bo             ChatGPT རྒྱུ་ཆེན་གཞི་བསྒྲུབ་ རྒྱལ་བཤད། 🖥️
// @name:bs             ChatGPT Režim širokog ekrana 🖥️
// @name:ca             ChatGPT Mode de pantalla ampla 🖥️
// @name:ceb            ChatGPT Lapadscreen 🖥️
// @name:ckb            ChatGPT دەستکاری چوارچێوەی ڕووکاری 🖥️
// @name:cs             ChatGPT Režim širokoúhlé obrazovky 🖥️
// @name:cy             ChatGPT Mod Sgrin Lled 🖥️
// @name:da             ChatGPT Bredformat-tilstand 🖥️
// @name:de             ChatGPT Breitbildmodus 🖥️
// @name:dv             ChatGPT ވިސްނުވެއް މޯޑި 🖥️
// @name:dz             ChatGPT འབྲེལ་བ་གཞུང་ལས་སྤྱི་ཚོགས་གླེང་། 🖥️
// @name:el             ChatGPT Λειτουργία ευρείας οθόνης 🖥️
// @name:eo             ChatGPT Larĝekrana reĝimo 🖥️
// @name:es             ChatGPT Modo de pantalla panorámica 🖥️
// @name:et             ChatGPT Laiarakenduse režiim 🖥️
// @name:eu             ChatGPT Pantaila Zabalaren Modua 🖥️
// @name:fa             ChatGPT حالت تلویزیونی 🖥️
// @name:fi             ChatGPT Laajakuva-tila 🖥️
// @name:fo             ChatGPT Búðarformaður háttur 🖥️
// @name:fr             ChatGPT Mode Écran Large 🖥️
// @name:fr-CA          ChatGPT Mode Écran Large 🖥️
// @name:gd             ChatGPT Dreach-sgrìn Leud 🖥️
// @name:gl             ChatGPT Modo de pantalla ancha 🖥️
// @name:gu             ChatGPT પ્રશાંત સ્ક્રીન મોડ 🖥️
// @name:haw            ChatGPT Widescreen 🖥️
// @name:he             ChatGPT מצב מסך רחב 🖥️
// @name:hi             ChatGPT चहचटजीपटी वाइडस्क्रीन मोड 🖥️
// @name:hr             ChatGPT Način širokog zaslona 🖥️
// @name:ht             ChatGPT Mod Fomat Gwo 🖥️
// @name:hu             ChatGPT Szélesvásznú mód 🖥️
// @name:hy             ChatGPT լայնէկրանանշանի ռեժիմ 🖥️
// @name:id             ChatGPT Mode Layar Lebar 🖥️
// @name:is             ChatGPT Breiðskjásstilling 🖥️
// @name:it             ChatGPT Modalità schermo panoramica 🖥️
// @name:ja             ChatGPT ワイドスクリーンモード 🖥️
// @name:jv             ChatGPT Mode Layar Lebar 🖥️
// @name:ka             ChatGPT ფანტსარიშის რეჟიმი 🖥️
// @name:kab            ChatGPT Amezwaru n Tikliwin Isellalen 🖥️
// @name:kk             ChatGPT Көлеңкескен түрі 🖥️
// @name:km             ChatGPT របៀបបង្អស្សមួយធ្វើដំបូង 🖥️
// @name:kn             ChatGPT ChatGPT ವೈಡ್ಸ್ಕ್ರೀನ್ ಮೋಡ್ 🖥️
// @name:ko             ChatGPT 와이드 스크린 모드 🖥️
// @name:ku             ChatGPT Moda Pêlên Dirêj 🖥️
// @name:ky             ChatGPT Жогорку Экрандык Режим 🖥️
// @name:la             ChatGPT Modus Latus Plenus 🖥️
// @name:lb             ChatGPT Breitbild-Modus 🖥️
// @name:lo             ChatGPT ຮູບແບບໂປຣຟອນໃຫຍ່ 🖥️
// @name:lt             ChatGPT Išplėstojo ekrano režimas 🖥️
// @name:lv             ChatGPT Plašā ekrāna režīms 🖥️
// @name:mg             ChatGPT Tarehimarika tamin'ny Widescreen 🖥️
// @name:mi             ChatGPT Āhua Whātika ā-Raupapa 🖥️
// @name:mk             ChatGPT Режим на широк екран 🖥️
// @name:ml             ChatGPT വൈഡ്സ്ക്രീൻ മോഡ് 🖥️
// @name:mn             ChatGPT Жинхэнэ Экранны Арга 🖥️
// @name:mr             चॅटजीपीटी वाइडस्क्रीन 🖥️
// @name:ms             ChatGPT Mod Skrin Lebar 🖥️
// @name:mt             ChatGPT Modalità Widescreen 🖥️
// @name:my             ChatGPT အများနှုန်းကျော်ဘုံ 🖥️
// @name:ne             ChatGPT विस्तृत प्राण्डविक पद्धति 🖥️
// @name:nl             ChatGPT Breedbeeldmodus 🖥️
// @name:no             ChatGPT Bredskjermmodus 🖥️
// @name:ny             ChatGPT Mawonekedwe Wathandiza 🖥️
// @name:pa             ChatGPT ਵਾਇਡਸਕ੍ਰੀਨ ਮੋਡ 🖥️
// @name:pl             ChatGPT Tryb szerokoekranowy 🖥️
// @name:ps             ChatGPT د ډیسپلې موډ 🖥️
// @name:pt             ChatGPT Modo Tela Larga 🖥️
// @name:pt-BR          ChatGPT Modo Tela Larga 🖥️
// @name:ro             ChatGPT Mod ecran lat 🖥️
// @name:ru             ChatGPT Режим широкоформатного экрана 🖥️
// @name:rw             ChatGPT Ibindi by'umuhondo bw'ishusho 🖥️
// @name:sg             ChatGPT Mode Écran Large 🖥️
// @name:si             ChatGPT විශේෂාංග පෙළක්ෂාව 🖥️
// @name:sk             ChatGPT Režim širokouhlého displeja 🖥️
// @name:sl             ChatGPT Način širokega zaslona 🖥️
// @name:sm             ChatGPT Laititi Fuamatala 🖥️
// @name:sn             ChatGPT Zvimwe Zvitsva Mode 🖥️
// @name:so             ChatGPT hab Widescreen Mode 🖥️
// @name:sq             ChatGPT me ekran të gjerë 🖥️
// @name:sr             ChatGPT Режим широког екрана 🖥️
// @name:st             ChatGPT Skrene e Phara 🖥️
// @name:sv             ChatGPT Bredbildsläge 🖥️
// @name:sw             ChatGPT Njia ya Skrini Panoramio 🖥️
// @name:ta             ChatGPT விரிவான திரை முறை 🖥️
// @name:te             ChatGPT ChatGPT వైడ్ స్క్రీన్ మోడ్ 🖥️
// @name:tg             ChatGPT Возачи Режаи Дисплеи Барнома 🖥️
// @name:th             ChatGPT โหมดหน้าจอแบบเต็มจอ 🖥️
// @name:ti             ቻትጂፒቲ ዋይድስክሪን ሞድ 🖥️
// @name:tk             ChatGPT Giň Ekran Tertibi 🖥️
// @name:tl             ChatGPT Malapad na Screen 🖥️
// @name:tn             ChatGPT Nyemba Yemba Mzizo 🖥️
// @name:to             ChatGPT Moli ʻo e Ngaahi Fatongi ʻo Haʻaneesi 🖥️
// @name:tr             ChatGPT Geniş Ekran Modu 🖥️
// @name:tt             ChatGPT киң экран 🖥️
// @name:ug             ChatGPT keng ekran 🖥️
// @name:uk             ChatGPT Режим широкого екрана 🖥️
// @name:ur             ChatGPT وائڈ اسکرین موڈ 🖥️
// @name:uz             ChatGPT Keng ekranga rejim 🖥️
// @name:vi             ChatGPT Chế độ Màn hình Rộng 🖥️
// @name:wo             ChatGPT écran large 🖥️
// @name:xh             ChatGPT Indlela ye-Widescreen Mode 🖥️
// @name:yi             ChatGPT ווידעסקרעען מאָדע 🖥️
// @name:yo             Wide iboju 🖥️ ChatGPT
// @name:zh             ChatGPT 宽屏模式 🖥️
// @name:zh-CN          ChatGPT 宽屏模式 🖥️
// @name:zh-HK          ChatGPT 寬螢幕模 🖥️
// @name:zh-SG          ChatGPT 宽屏模式 🖥️
// @name:zh-TW          ChatGPT 寬螢幕模 🖥️
// @name:zu             ChatGPT Isimo sokudlalwa emkhumbini 🖥️
// @description         Enhances ChatGPT with wide/full/tall-screen + spamblock modes. Also works on perplexity.ai + poe.com!
// @description:af      Verbetert ChatGPT met breë/volle/lang-skerm + spamblokkeringsmodusse. Werk ook op perplexity.ai + poe.com!
// @description:am      ቻትጂፒቲን በትልቅ/ሙሉ/ረጅም ስክሪን + ስፓም ብሎክ ሞዶች ይማራል። በperplexity.ai + poe.com ላይም ይሰራል!
// @description:ar      يعزز ChatGPT مع أوضاع الشاشة الواسعة / الكاملة / الطويلة + وضع حظر الرسائل المزعجة. يعمل أيضًا على perplexity.ai + poe.com!
// @description:az      ChatGPT-ni geniş/dolğu/yüksək ekran + spam bloklama rejimləri ilə təkmilləşdirir. Həmçinin perplexity.ai + poe.com-da işləyir!
// @description:be      Палепшыць ChatGPT з рэжымамі шырокі/поўны/высокі экран + блокаванне спаму. Таксама працуе на perplexity.ai + poe.com!
// @description:bem     ChatGPT ikalishe na mawodi ya kufyala/kukwata/manyefu + spamblock. Ikaba na ntchito ku perplexity.ai + poe.com!
// @description:bg      Подобрява ChatGPT с режими за широк екран/пълен/висок + блокиране на спам. Работи също на perplexity.ai + poe.com!
// @description:bn      চ্যাটজিপিটি কে প্রশস্ত/পূর্ণ/উচ্চ-স্ক্রীন + স্প্যামব্লক মোডের সাথে উন্নত করে। এটি perplexity.ai + poe.com-এও কাজ করে!
// @description:bo      ChatGPTའདི་ལུང་བརྗེད་འཕྲིན་སྐོར་དབྱར་ཆེན་སྐོར་འདི་ཡིན་ནི་ཁ་ལོག་+ spamblock མཉམ་སྒོའི་མཐར་ཕྱོགས་མཛད་ཡིན། perplexity.ai + poe.com་ལ་འགྱོ་ཡིན།
// @description:bs      Poboljšava ChatGPT s režimima širokog/punog/visokog ekrana + blokade spama. Također radi na perplexity.ai + poe.com!
// @description:ca      Millora ChatGPT amb modes d'écran ampli/complet/alt + modes de bloqueig de correu brossa. També funciona a perplexity.ai + poe.com!
// @description:ceb     Nagpalambo sa ChatGPT gamit ang lapad/puno/taas-screen + spamblock nga mga mode. Nagtrabaho usab kini sa perplexity.ai + poe.com!
// @description:ckb     پارەکەری دەکات ChatGPT بە ڕووکاری وشەی کەسەرە/کامل/بەرز + ڕووکاری پەڕەی ڕووكارەوە. هەروەها کاردەکاتە سەر perplexity.ai + poe.com!
// @description:cs      Vylepšuje ChatGPT s režimy širokého/plného/vysokého displeje + blokování spamu. Také funguje na perplexity.ai + poe.com!
// @description:cy      Gwella ChatGPT gyda fodiwlau sgrin eang/lawn/uchel + blocio sbam. Mae'n gweithio hefyd ar perplexity.ai + poe.com!
// @description:da      Forbedrer ChatGPT med brede/fulde/høje skærm + spamblock-modes. Virker også på perplexity.ai + poe.com!
// @description:de      Erweitert ChatGPT mit breiten/vollen/großen Bildschirm- und Spamblock-Modi. Funktioniert auch auf perplexity.ai + poe.com!
// @description:dv      ކަމަށް ChatGPT މެއްދައްކާ ދެއްވިފައިވަން / ފަލްލާލް / ހަމަކޮށް ބަށަލަތް + ސްޕެމބލޮކް މޮދުންގެންޓެކަށް އެލެކް ކައިވެލް perplexity.ai + poe.com!
// @description:dz      འཕེལ་འབྱོར་ལས ChatGPT ནི་རོགས་བཏོད་འབུལ་མཉམ་ནོར་འཛུལ་སྒོར་དབྱར་དགོན་/འཛིང་སྒོར་སྤུས་ནང་མཐར་ཕྱོགས་ལེགས་རོགས་ཡིན། perplexity.ai + poe.com་ནང་འཁོད་འཇུག་ཡིན།
// @description:el      Ενισχύει το ChatGPT με λειτουργίες ευρείας/πλήρους/υψηλής οθόνης + μπλοκ αποστολής ανεπιθύμητης αλληλογραφίας. Λειτουργεί επίσης στο perplexity.ai + poe.com!
// @description:eo      Plibonigas ChatGPT kun larĝa/plena/alta ekrano + blokado de spamo. Ankaŭ funkcias ĉe perplexity.ai + poe.com!
// @description:es      Mejora ChatGPT con modos de pantalla ancha/completa/alta + modo de bloqueo de spam. También funciona en perplexity.ai + poe.com!
// @description:et      Parandab ChatGPT lai lai/terve/täiesti-ekraani + spämmi blokeerimisrežiimid. Töötab ka perplexity.ai + poe.com!
// @description:eu      Hobetzen du ChatGPT zabala/oso/altua pantaila + spam blokeatzeko moduekin. Perplexity.ai + poe.com-n ere funtzionatzen du!
// @description:fa      ChatGPT را با حالت های صفحه عریض/تمام/بلند + مسدودسازی هرزنامه بهبود می بخشد. همچنین در perplexity.ai + poe.com کار می کند!
// @description:fi      Parantaa ChatGPT:tä laaja/ täysi/ korkea näyttö + roskapostin estäminen -tiloilla. Toimii myös perplexity.ai + poe.com!
// @description:fo      Bætir ChatGPT við breiðum/fullum/háum skjá + ruslpósthemlunaraðgerðum. Virkar einnig á perplexity.ai + poe.com!
// @description:fr      Améliore ChatGPT avec les modes écran large/complet/grand + mode anti-spam. Fonctionne également sur perplexity.ai + poe.com !
// @description:fr-CA   Améliore ChatGPT avec les modes écran large/complet/grand + mode anti-spam. Fonctionne également sur perplexity.ai + poe.com !
// @description:gd      Leasaich ChatGPT le modhan scrion farsaing/làn/àrd + modan bacadh spàm. Bidh e ag obair cuideachd air perplexity.ai + poe.com!
// @description:gl      Mellora ChatGPT con modos de pantalla ancha/completa/alta + modo de bloqueo de spam. Tamén funciona en perplexity.ai + poe.com!
// @description:gu      ચેટજીપીટીને વ્યાપક/પૂર્ણ/ઊંચી સ્ક્રીન + સ્પામબ્લોક મોડ્સ સાથે સુધારે છે. તે perplexity.ai + poe.com પર પણ કાર્ય કરે છે!
// @description:haw     Hoʻololi i ka ChatGPT me nā ʻano pālākiō / piha / kiʻekiʻe + nā ʻano pāpā spam. Hana pū kēia ma perplexity.ai + poe.com!
// @description:he      משדרג את ChatGPT עם מצבי מסך רחב/מלא/גבוה + חסימת דואר זבל. עובד גם ב-perplexity.ai + poe.com!
// @description:hi      चैटजीपीटी को चौड़े/पूर्ण/लंबे स्क्रीन + स्पैमब्लॉक मोड के साथ सुधारता है। यह perplexity.ai + poe.com पर भी काम करता है!
// @description:hr      Poboljšava ChatGPT s načinima širokog/punog/visokog ekrana + blokiranje neželjene pošte. Također radi na perplexity.ai + poe.com!
// @description:ht      Amelyore ChatGPT ak mòd ekran laj/pou/bonè + mod blokaj spam. Li travay tou sou perplexity.ai + poe.com!
// @description:hu      Fejleszti a ChatGPT-t széles/teljes/magas képernyős + spamblokkoló módokkal. A perplexity.ai + poe.com oldalon is működik!
// @description:hy      ChatGPT-ն բարելավում է լայն/պատասխանատու/բարձր էկրանի + սպամի բլոկավորման ռեժիմներով: Այն նաև գործում է perplexity.ai + poe.com-ում!
// @description:id      Meningkatkan ChatGPT dengan mode layar lebar/penuh/tinggi + mode pemblokiran spam. Juga bekerja di perplexity.ai + poe.com!
// @description:is      Bætir ChatGPT með breiðum/fullum/háum skjá + ruslpósthemlunaraðgerðum. Virkar einnig á perplexity.ai + poe.com!
// @description:it      Migliora ChatGPT con modalità schermo ampio/completo/alto + modalità di blocco spam. Funziona anche su perplexity.ai + poe.com!
// @description:ja      ChatGPTを広い/フル/高画面+スパムブロックモードで強化します。また、perplexity.ai + poe.comでも動作します！
// @description:jv      Ningkataké ChatGPT nganggo mode layar jembar/penuh/tinggi + mode blokir spam. Uga bisa digunakake ing perplexity.ai + poe.com!
// @description:ka      აუმჯობესებს ChatGPT-ს ფართო/სრული/სიმაღლის ეკრანის + სპამ-ბლოკირების რეჟიმებით. ასევე მუშაობს perplexity.ai + poe.com-ზე!
// @description:kab     Yernu ChatGPT s yimezda n uferq/aṭṭas/uzelmat di tgejdit. Tura yettsen-d deg perplexity.ai akked poe.com!
// @description:kk      ChatGPT-ні кең/толық/биік экран + спам блоктау режимдерімен жақсартады. Сонымен қатар, perplexity.ai + poe.com сайттарында жұмыс істейді!
// @description:km      បង្កើន ChatGPT ជាមួយម៉ូដអេក្រង់ទូលំទូលាយ/ពេញលេញ/កម្ពស់ + ម៉ូដប្លុកស្ពាម។ ក៏ដូចជាធ្វើការនៅលើ perplexity.ai + poe.com!
// @description:kn      ಚಾಟ್GPTನ್ನು ವಿಶಾಲ/ಪೂರ್ಣ/ಎತ್ತರದ-ಸ್ಕ್ರೀನ್ + ಸ್ಪ್ಯಾಮ್‌ಬ್ಲಾಕ್‌ ಮೋಡ್‌ಗಳೊಂದಿಗೆ ಸುಧಾರಿಸುತ್ತದೆ. ಇದು perplexity.ai + poe.com ನಲ್ಲಿ ಸಹ ಕಾರ್ಯನಿರ್ವಹಿಸುತ್ತದೆ!
// @description:ko      ChatGPT를 와이드/풀/높은 화면 + 스팸 차단 모드로 향상시킵니다. 또한 perplexity.ai + poe.com에서도 작동합니다!
// @description:ku      ChatGPT-ê bi modên pêşandanê nermal/temam/dirêj + spam-block veşart dike. Hêmû de li perplexity.ai + poe.com jî dixebite!
// @description:ky      ChatGPT-ni keng/temam/biyik ekran + spam-block rejimderi menen jaqsyrtady. Ol perplexity.ai + poe.com-da da ishleydi!
// @description:la      ChatGPT cum latum/plenum/altum screen + spam blockade modis emendatur. Etiam in perplexity.ai + poe.com operatur!
// @description:lb      ChatGPT mat weiten/ganz/hoechst Schirm + Spamblock Modi verbessert. Et funktionnéiert och op perplexity.ai + poe.com!
// @description:lo      ພັກພັນ ChatGPT ກັບສະກຣີນຫຼາຍ/ຄົບຮອບ/ສູງ + ມູດກັບສະປາມ. ມັນກະທຳງານຢູ່ perplexity.ai + poe.com!
// @description:lt      Patobulina ChatGPT su plačiais/visiškais/aukštais ekrano + spam blokavimo režimais. Taip pat veikia ant perplexity.ai + poe.com!
// @description:lv      Uzlabo ChatGPT ar plaša/pilna/augsta ekrāna + surogātprogrammu bloķēšanas režīmiem. Tāpat darbojas arī perplexity.ai + poe.com!
// @description:mg      Manatsara ChatGPT miaraka amin'ny fomba feno/sarotra/haavo + fanakanana spam. Miasa amin'ny perplexity.ai + poe.com koa!
// @description:mi      Whakarei i ChatGPT me ngā huarahi rahi/paerewa/teitei + he poke pātea. Kei te mahi hoki i runga i perplexity.ai + poe.com!
// @description:mk      Ја подобрува ChatGPT со режими за широк/полн/висок екран + блокирање на спам. Работи и на perplexity.ai + poe.com!
// @description:ml      ചാറ്റ്‌ജിപിടി വിപുല/പൂര്‍ണ/ഉയര്‍ന്ന സ്ക്രീന്‍ + സ്‌പാം ബ്ലോക്ക് മോഡുകളോടെ മെച്ചപ്പെടുത്തുന്നു. ഇത് perplexity.ai + poe.com-ലും പ്രവര്‍ത്തിക്കുന്നു!
// @description:mn      ChatGPT-г өргөн/бүтэн/өндөр дэлгэц + спам блоклогч горимуудтай сайжруулна. Мөн perplexity.ai + poe.com дээр ажиллана!
// @description:mr      चैटGPTला विस्तृत/पूर्ण/उच्च-स्क्रीन + स्पॅम ब्लॉक मोडसह सुधारते. हे perplexity.ai + poe.com वर देखील कार्य करते!
// @description:ms      Meningkatkan ChatGPT dengan mod paparan lebar/penuh/tinggi + mod penyekatan spam. Ia juga berfungsi di perplexity.ai + poe.com!
// @description:mt      Ittejjeb ChatGPT bi modalità ta' skrin wiesgħa/piena/ogħla + modalità ta' blokkjar ta' spam. Jaħdem ukoll fuq perplexity.ai + poe.com!
// @description:my      ChatGPT ကို ကျယ်/ပြည့်/အရည်အချင်းပြည့်သော စကရင် + စပෑမ် ဘလော့ခ် မုဒ်များဖြင့် တိုးတက်စေသည်။ ဒါဟာ perplexity.ai + poe.com ပေါ်မှာလဲ အလုပ်လုပ်ပါတယ်!
// @description:ne      चौडाइ/पूर्ण/उचाइ-स्क्रीन + स्प्याम ब्लॉक मोडसहित ChatGPT लाई सुधार्नुहोस्। यो perplexity.ai + poe.com मा पनि काम गर्दछ!
// @description:nl      Verbetert ChatGPT met brede/volle/hoge scherm + spamblokkering modi. Werkt ook op perplexity.ai + poe.com!
// @description:no      Forbedrer ChatGPT med brede/full/høye skjerm + spamblock-modus. Også tilgjengelig på perplexity.ai + poe.com!
// @description:ny      Apanga ChatGPT ndi makonda a chinsalu cha ambiri/chonse/chikulu + njira zowononga spam. Imagwira ntchito pa perplexity.ai + poe.com!
// @description:pa      ਚੈਟਜੀਪੀਟੀ ਨੂੰ ਵਿਆਪਕ/ਪੂਰਨ/ਉੱਚ ਸਕ੍ਰੀਨ + ਸਪੈਮ ਬਲੌਕ ਮੋਡ ਨਾਲ ਸੁਧਾਰਦਾ ਹੈ। ਇਹ perplexity.ai + poe.com 'ਤੇ ਵੀ ਕੰਮ ਕਰਦਾ ਹੈ!
// @description:pl      Ulepsza ChatGPT za pomocą trybów szerokiego/pełnego/wysokiego ekranu + blokady spamu. Działa również na perplexity.ai + poe.com!
// @description:ps      ChatGPT ته د پراخ/مکمل/لوړ سکرین + سپیم بلاک کولو حالتونو سره وده ورکوي. دا په perplexity.ai + poe.com کې هم کار کوي!
// @description:pt      Melhora o ChatGPT com modos de tela larga/completa/alta + modos de bloqueio de spam. Também funciona em perplexity.ai + poe.com!
// @description:pt-BR   Melhora o ChatGPT com modos de tela larga/completa/alta + modos de bloqueio de spam. Também funciona em perplexity.ai + poe.com!
// @description:ro      Îmbunătățește ChatGPT cu moduri de ecran larg/complet/înalt + moduri de blocare a spamului. De asemenea, funcționează pe perplexity.ai + poe.com!
// @description:ru      Улучшает ChatGPT с режимами широкого/полного/высокого экрана и блокировки спама. Также работает на perplexity.ai + poe.com!
// @description:rw      Guhuza ChatGPT hamwe n'ibimenyetso bya ekran nini/bikozwe/byinshi + uburyo bwo gukumira spam. Kandi ikora ku perplexity.ai + poe.com!
// @description:sg      Améliore ChatGPT avec les modes d’écran large/complet/haut + le mode de blocage de spam. Fonctionne également sur perplexity.ai + poe.com!
// @description:si      ChatGPT එක විශාල/සම්පූර්ණ/ඉහළ-පෙරටු + ස්පාම් බ්ලොක් ක්‍රම මඟින් වැඩිදියුණු කරයි. මෙය perplexity.ai + poe.com හිද ක්‍රියාත්මක වේ!
// @description:sk      Zlepšuje ChatGPT s režimami širokého/plného/vysokého displeja + blokovanie spamu. Takéto funguje aj na perplexity.ai + poe.com!
// @description:sl      Izboljšuje ChatGPT z načini širokega/polnega/visokega zaslona + blokado neželene pošte. Prav tako deluje na perplexity.ai + poe.com!
// @description:sm      Fa'amaoniga ChatGPT i auala laupapa/puni/lamava + metotia o le 'spam' fa'atekinolosi. E fa'amaoni i perplexity.ai + poe.com!
// @description:sn      Zvikurudzira ChatGPT nehutungamiri hwepamusoro/huzhinji/hupfumi + matanho ekudzivirira spam. Zvinotora chirevo pa perplexity.ai + poe.com!
// @description:so      Hagaajinta ChatGPT iyadoo la adeegsanayo hababka shaashadda ballaaran/buuxa/sare + habka xanniba spam. Waxa kale oo ay ka shaqeysaa perplexity.ai + poe.com!
// @description:sq      Pëmirëson ChatGPT me modulet e ekranit të gjerë/të plotë/të lartë + bllokimin e spamit. Po ashtu punon në perplexity.ai + poe.com!
// @description:sr      Unapređuje ChatGPT sa režimima širokog/punog/visokog ekrana + blokadom spama. Takođe funkcioniše na perplexity.ai + poe.com!
// @description:st      Khothaletsa ChatGPT ka mekhoa ea skrine e kholo/e felletseng/e phahameng + mekhoa ea thibelo ea spam. E sebetsa hape ho perplexity.ai + poe.com!
// @description:sv      Förbättrar ChatGPT med bred/full/hög skärm + spamblock-lägen. Fungerar också på perplexity.ai + poe.com!
// @description:sw      Inaboresha ChatGPT kwa hali ya skrini pana/kamilifu/ya juu + hali ya kuzima spam. Pia inafanya kazi kwenye perplexity.ai + poe.com!
// @description:ta      ChatGPTஐ விரிவான/முழு/உயர்ந்த திரை + ஸ்பாம் தடுப்பு முறைமைகளுடன் மேம்படுத்துகிறது. இது perplexity.ai + poe.com இல் செயல்படுகிறது!
// @description:te      చాట్GPTని విస్తృత/పూర్ణ/ఎత్తు-స్క్రీన్ + స్పామ్ బ్లాక్ మోడ్‌లతో మెరుగుపరుస్తుంది. ఇది perplexity.ai + poe.comపై కూడా పని చేస్తుంది!
// @description:tg      ChatGPT-ро бо режими экранҳои васеъ/комил/баланд + блоки спам такмил медиҳад. Ҳамчунин дар perplexity.ai + poe.com кор мекунад!
// @description:th      ปรับปรุง ChatGPT ด้วยโหมดหน้าจอกว้าง/เต็ม/สูง + โหมดบล็อกสแปม ทำงานได้ที่ perplexity.ai + poe.com!
// @description:ti      ቻትጂፒቲን በስፋት/ሙሉ/ረጅም ስክሪን + ስፓም ብሎክ ሞዶች ይማራል። በperplexity.ai + poe.com ላይም ይሰራል!
// @description:tk      ChatGPT-ni giňişleýin/dolup/buýuk ekran + spam blokirlemek ýagdaýlarynda gowulandyrýar. Şeýle hem perplexity.ai + poe.com-da işleýär!
// @description:tl      Pinapabuti ang ChatGPT gamit ang mga mode ng malawak/puno/mataas na screen + mode ng pagharang sa spam. Gumagana rin ito sa perplexity.ai + poe.com!
// @description:tn      Tokafatsa ChatGPT ka ditsela tsa sehaweng se se pharaletseng/se felletseng/se phahameng + ditsela tsa ho thibela spam. E sebetsa hape ho perplexity.ai + poe.com!
// @description:to      Fa'amaonia ChatGPT i auala mata'itusi laupapa/puni/lamava + auala fa'amaoniga spam. E mafai foi ona fa'agaioi i perplexity.ai + poe.com!
// @description:tr      ChatGPT'yi geniş/tam/yüksek ekran + spam engelleme modlarıyla geliştirir. Ayrıca perplexity.ai + poe.com'da da çalışır!
// @description:tt      ChatGPT-ны киң/тулы/югары экран + спам блоклау режимнары белән яхшырта. Шул ук вакытта perplexity.ai + poe.com да эшли!
// @description:ug      ChatGPT'ni keng/to'liq/yuqori ekran + spam blokirovka rejimlari bilan yaxshilaydi. Shuningdek, perplexity.ai + poe.com saytlarida ishlaydi!
// @description:uk      Покращує ChatGPT за допомогою режимів широкого/повного/високого екрану + блокування спаму. Також працює на perplexity.ai + poe.com!
// @description:ur      چیٹ جی پی ٹی کو وسیع/مکمل/اونچی اسکرین + اسپام بلاک موڈ کے ساتھ بہتر کرتا ہے۔ یہ perplexity.ai + poe.com پر بھی کام کرتا ہے!
// @description:uz      ChatGPT-ni keng/to'liq/baland ekran + spam bloklash rejimlari bilan yaxshilaydi. Bundan tashqari, perplexity.ai + poe.com-da ham ishlaydi!
// @description:vi      Cải thiện ChatGPT với các chế độ màn hình rộng/toàn màn/hồ sơ cao + chế độ chặn spam. Cũng hoạt động trên perplexity.ai + poe.com!
// @description:wo      Jëfandikoo ChatGPT ak modu yu gëstu-gëstu/fini/gëstu guddi + mode spam-block. It works too on perplexity.ai + poe.com!
// @description:xh      Ukuphucula iChatGPT ngezithuba zesikrini ezibanzi/egcwele/ephezulu + imodi ye-spamblock. Isebenza ku-perplexity.ai + poe.com!
// @description:yi      אַוואַנסירטער ChatGPT מיט ברייט/גאַנץ/הויך-סקירן + ספּאַם בלאָק מאָדעס. עס אַרבעט אויך אויף perplexity.ai + poe.com!
// @description:yo      Ṣe ilọsiwaju ChatGPT pẹlu awọn ipo iboju jakejado/pipe/giga + ipo idiwọ spam. O tun n ṣiṣẹ lori perplexity.ai + poe.com!
// @description:zh      通过宽屏/全屏/高屏+垃圾邮件块模式增强 ChatGPT。也可以在 perplexity.ai + poe.com 上使用！
// @description:zh-CN   通过宽屏/全屏/高屏+垃圾邮件块模式增强 ChatGPT。也可以在 perplexity.ai + poe.com 上使用！
// @description:zh-HK   使用寬/全/高螢幕+垃圾郵件區塊模式增強 ChatGPT。也可以在 perplexity.ai + poe.com 上使用！
// @description:zh-SG   通过宽屏/全屏/高屏+垃圾邮件块模式增强 ChatGPT。也可以在 perplexity.ai + poe.com 上使用！
// @description:zh-TW   使用寬/全/高螢幕+垃圾郵件區塊模式增強 ChatGPT。也可以在 perplexity.ai + poe.com 上使用！
// @description:zu      Thuthukisa iChatGPT ngemodi zesikrini ezibanzi/egcwele/ephezulu + imodi yokuvimbela i-spam. Futhi isebenza ku-perplexity.ai + poe.com!
// @author              Adam Lui
// @namespace           https://github.com/adamlui
// @version             2025.3.15.2
// @license             MIT
// @icon                https://assets.chatgptwidescreen.com/images/icons/widescreen-robot-emoji/icon48.png?v=844b16e
// @icon64              https://assets.chatgptwidescreen.com/images/icons/widescreen-robot-emoji/icon64.png?v=844b16e
// @compatible          chrome
// @compatible          firefox
// @compatible          edge
// @compatible          opera
// @compatible          brave
// @compatible          vivaldi
// @compatible          librewolf
// @compatible          ghost
// @compatible          qq
// @match               *://chatgpt.com/*
// @match               *://*.perplexity.ai/*
// @match               *://poe.com/*
// @connect             cdn.jsdelivr.net
// @connect             gm.chatgptwidescreen.com
// @connect             raw.githubusercontent.com
// @require             https://cdn.jsdelivr.net/npm/@kudoai/chatgpt.js@3.7.1/dist/chatgpt.min.js#sha256-uv1k2VxGy+ri3+2C+D/kTYSBCom5JzvrNCLxzItgD6M=
// @require             https://cdn.jsdelivr.net/npm/json5@2.2.3/dist/index.min.js#sha256-S7ltnVPzgKyAGBlBG4wQhorJqYTehj5WQCrADCKJufE=
// @require             https://cdn.jsdelivr.net/gh/adamlui/chatgpt-widescreen@dc5d5ad/chromium/extension/lib/chatbar.js#sha256-YV53DGFoNrgTkwHo3ziPf6ym+aoNVIil8XcG/xztzyI=
// @require             https://cdn.jsdelivr.net/gh/adamlui/chatgpt-widescreen@58c2d29/chromium/extension/lib/dom.js#sha256-WXPxvMnJU6LGvINaENBbmvGXTAcAlXlBkyGwIDGXiC4=
// @require             https://cdn.jsdelivr.net/gh/adamlui/chatgpt-widescreen@cc1452d/chromium/extension/lib/settings.js#sha256-61hKRmY1j18By0lygK8mUqUHP0OP6czHrq4FFPJNxAY=
// @require             https://cdn.jsdelivr.net/gh/adamlui/chatgpt-widescreen@f9ebcb0/chromium/extension/lib/ui.js#sha256-Bg82hwdZyJAORV7B6Vg3uIxQ8qnJhCsU624NyjQrKcA=
// @require             https://cdn.jsdelivr.net/gh/adamlui/chatgpt-widescreen@f9ebcb0/chromium/extension/components/buttons.js#sha256-+5qVTeQkcYg7r4sAfUAtSD1D9HTKF+Jo3Sin4ZjYDEc=
// @require             https://cdn.jsdelivr.net/gh/adamlui/chatgpt-widescreen@05601b9/chromium/extension/components/icons.js#sha256-RG/BVbnnWk4KPfsvdmtZSsIs9XcsdV2yUwPN2PikJe4=
// @require             https://cdn.jsdelivr.net/gh/adamlui/chatgpt-widescreen@9d778e8/chromium/extension/components/modals.js#sha256-dMLSR939RGAI/ilIXt8Nnzq0QyKaUn89+AdPpNhGgtM=
// @require             https://cdn.jsdelivr.net/gh/adamlui/chatgpt-widescreen@54e97d9/chromium/extension/components/tooltip.js#sha256-GljOgUbR7hOssEk0DWGgDEXbJBfG2XnmlxMTm0nZ/Jw=
// @resource rpgCSS     https://assets.aiwebextensions.com/styles/rising-particles/dist/gray.min.css?v=727feff#sha256-48sEWzNUGUOP04ur52G5VOfGZPSnZQfrF3szUr4VaRs=
// @resource rpwCSS     https://assets.aiwebextensions.com/styles/rising-particles/dist/white.min.css?v=727feff#sha256-6xBXczm7yM1MZ/v0o1KVFfJGehHk47KJjq8oTktH4KE=
// @grant               GM_setValue
// @grant               GM_getValue
// @grant               GM_registerMenuCommand
// @grant               GM_unregisterMenuCommand
// @grant               GM_getResourceText
// @grant               GM_xmlhttpRequest
// @grant               GM.xmlHttpRequest
// @noframes
// @downloadURL         https://gm.chatgptwidescreen.com
// @updateURL           https://gm.chatgptwidescreen.com
// @homepageURL         https://www.chatgptwidescreen.com
// @supportURL          https://support.chatgptwidescreen.com
// @contributionURL     https://github.com/sponsors/adamlui
// ==/UserScript==

// Documentation: https://docs.chatgptwidescreen.com
// NOTE: This script relies on the powerful chatgpt.js library @ https://chatgpt.js.org
//  © 2023–2025 KudoAI & contributors under the MIT license.

(async () => {

    // Init ENV context
    const env = {
        browser: {
            language: chatgpt.getUserLanguage(), isFF: chatgpt.browser.isFirefox(), isMobile: chatgpt.browser.isMobile()
        },
        scriptManager: {
            name: (() => { try { return GM_info.scriptHandler } catch (err) { return 'unknown' }})(),
            version: (() => { try { return GM_info.version } catch (err) { return 'unknown' }})()
        },
        site: /([^.]+)\.[^.]+$/.exec(location.hostname)[1], ui: {}
    }
    env.browser.isPortrait = env.browser.isMobile && (innerWidth < innerHeight)
    env.scriptManager.supportsTooltips = env.scriptManager.name == 'Tampermonkey'
                                      && parseInt(env.scriptManager.version.split('.')[0]) >= 5
    ui.import({ site: env.site }) ; ui.getScheme().then(scheme => env.ui.scheme = scheme)
    if (env.site == 'chatgpt') // store native chatbar width for Wider Chatbox style
        chatbar.nativeWidth = dom.get.computedWidth(document.querySelector('main form'))
    const xhr = typeof GM != 'undefined' && GM.xmlHttpRequest || GM_xmlhttpRequest

    // Init APP data
    const app = {
        version: GM_info.script.version, configKeyPrefix: `${env.site} Widescreen`,
        chatgptJSver: /chatgpt\.js@([\d.]+)/.exec(GM_info.scriptMetaStr)[1],
        urls: { update: 'https://gm.chatgptwidescreen.com' },
        latestResourceCommitHash: '7fb1782' // for cached app.json + sites.json5 + messages.json
    }
    app.urls.resourceHost = `https://cdn.jsdelivr.net/gh/adamlui/chatgpt-widescreen@${app.latestResourceCommitHash}`
    const remoteAppData = await new Promise(resolve => xhr({
        method: 'GET', url: `${app.urls.resourceHost}/assets/data/app.json`,
        onload: resp => resolve(JSON.parse(resp.responseText))
    }))
    Object.assign(app, { ...remoteAppData, urls: { ...app.urls, ...remoteAppData.urls }})
    app.msgs = {
        appName: app.name,
        appAuthor: app.author.name,
        appDesc: 'Adds Widescreen + Fullscreen modes to ChatGPT for enhanced viewing + reduced scrolling',
        menuLabel_fullerWins: 'Fuller Windows',
        menuLabel_tallerChatbox: 'Taller Chatbox',
        menuLabel_widerChatbox: 'Wider Chatbox',
        menuLabel_newChatBtn: 'New Chat Button',
        menuLabel_hiddenHeader: 'Hidden Header',
        menuLabel_hiddenFooter: 'Hidden Footer',
        menuLabel_btnAnimations: 'Button Animations',
        menuLabel_modeNotifs: 'Mode Notifications',
        menuLabel_blockSpam: 'Spam Block',
        menuLabel_siteSettings: 'Site Settings',
        menuLabel_about: 'About',
        menuLabel_donate: 'Please send a donation',
        menuLabel_extensionActive: 'extension active',
        about_author: 'Author',
        about_and: '&',
        about_contributors: 'contributors',
        about_version: 'Version',
        about_poweredBy: 'Powered by',
        about_openSourceCode: 'Open source code',
        mode_wideScreen: 'Wide screen',
        mode_fullWindow: 'Full-window',
        mode_fullScreen: 'Full screen',
        tooltip_wideScreenON: 'Wide screen',
        tooltip_wideScreenOFF: 'Exit wide screen',
        tooltip_fullWindowON: 'Full-window mode',
        tooltip_fullWindowOFF: 'Exit full window',
        tooltip_fullScreenON: 'Full screen',
        tooltip_fullScreenOFF: 'Exit full screen',
        tooltip_newChat: 'New chat',
        helptip_fullerWins: 'Also activate Wide Screen when activating Full-Window',
        helptip_tallerChatbox: 'Expand the chatbox vertically',
        helptip_widerChatbox: 'Expand the chatbox horizontally in Wide Screen mode',
        helptip_newChatBtn: 'Show New Chat button in chatbox',
        helptip_hiddenFooter: 'Hide site footer',
        helptip_hiddenHeader: 'Hide site header',
        helptip_btnAnimations: 'Animate chatbar buttons on hover',
        helptip_modeNotifs: 'Show notifications when toggling modes/settings',
        helptip_blockSpam: 'Hide spam banners from cluttering the page',
        helptip_enableDisable: 'Enable/disable',
        helptip_perSite: 'per site',
        helptip_run: 'Run',
        alert_choosePlatform: 'Choose a platform',
        alert_updateAvail: 'Update available',
        alert_newerVer: 'An update to',
        alert_isAvail: 'is available',
        alert_upToDate: 'Up-to-date',
        alert_isUpToDate: 'is up-to-date',
        alert_showYourSupport: 'Show your support',
        alert_isOSS: 'is open-source software built & maintained for free through 100% volunteer efforts',
        alert_despiteAffliction: 'Despite being severely afflicted by',
        alert_longCOVID: 'long COVID',
        alert_since2020: 'since 2020',
        alert_byDonatingResults: 'by donating, you help me to continue improving, fixing bugs, adding new features, and making the software even better',
        alert_yourContrib: 'Your contribution',
        alert_noMatterSize: 'no matter the size',
        alert_directlySupports: 'directly supports my unpaid efforts to ensure this project remains free and open for all to use',
        alert_tyForSupport: 'Thank you for your support',
        alert_pressF11: 'Press F11 to exit full screen',
        alert_f11reason: 'F11 was used to enter full screen, and due to browser security reasons, the same key must be used to exit it',
        notif_chatStopped: 'Chat stopped',
        btnLabel_moreAIextensions: 'More AI Extensions',
        btnLabel_rateUs: 'Rate Us',
        btnLabel_discuss: 'Discuss',
        btnLabel_getSupport: 'Get Support',
        btnLabel_checkForUpdates: 'Check for Updates',
        btnLabel_update: 'Update',
        btnLabel_dismiss: 'Dismiss',
        link_viewChanges: 'View changes',
        state_disabled: 'disabled',
        state_on: 'on',
        state_off: 'off'
    }

    // LOCALIZE app.msgs for non-English users
    if (!env.browser.language.startsWith('en')) {
        const localizedMsgs = await new Promise(resolve => {
            const msgHostDir = app.urls.resourceHost + '/chromium/extension/_locales/',
                  msgLocaleDir = ( env.browser.language ? env.browser.language.replace('-', '_') : 'en' ) + '/'
            let msgHref = msgHostDir + msgLocaleDir + 'messages.json', msgXHRtries = 0
            function fetchMsgs() { xhr({ method: 'GET', url: msgHref, onload: handleMsgs })}
            function handleMsgs(resp) {
                try { // to return localized messages.json
                    const msgs = JSON.parse(resp.responseText), flatMsgs = {}
                    for (const key in msgs) // remove need to ref nested keys
                        if (typeof msgs[key] == 'object' && 'message' in msgs[key])
                            flatMsgs[key] = msgs[key].message
                    resolve(flatMsgs)
                } catch (err) { // if bad response
                    msgXHRtries++ ; if (msgXHRtries == 3) return resolve({}) // try original/region-stripped/EN only
                    msgHref = env.browser.language.includes('-') && msgXHRtries == 1 ? // if regional lang on 1st try...
                        msgHref.replace(/([^_]+_[^_]+)_[^/]*(\/.*)/, '$1$2') // ...strip region before retrying
                            : ( msgHostDir + 'en/messages.json' ) // else use default English messages
                    fetchMsgs()
                }
            }
            fetchMsgs()
        })
        Object.assign(app.msgs, localizedMsgs)
    }

    // Init SITE profiles
    const sites = Object.assign(Object.create(null), await new Promise(resolve => xhr({
        method: 'GET', url: `${app.urls.resourceHost}/assets/data/sites.json5`,
        onload: resp => resolve(JSON5.parse(resp.responseText))
    })))

    // Export DEPENDENCIES to imported resources
    chatbar.import({ site: env.site, sites }) // for conditional logic + sites.selectors
    dom.import({ scheme: env.ui.scheme }) // for dom.addRisingParticles()
    modals.import({ app, env, updateCheck }) // for app data + env['<browser|ui>'] flags + modals.about() update btn
    settings.import({ app, site: env.site, sites }) // for app.configKeyPrefix + to load/save `${site}Disabled`
    tooltip.import({ msgs: app.msgs, site: env.site, sites }) // for tooltip.update() i18n + position logic
    ui.import({ sites }) // for ui.isFullWin() sidebar selector/flag

    // Init SETTINGS
    if (GM_getValue(`${app.configKeyPrefix}_isFirstRun`) == undefined) { // activate widescreen on install
        settings.save('wideScreen', true) ; settings.save('isFirstRun', false) }
    settings.siteDisabledKeys = Object.keys(sites).map(site => `${site}Disabled`)
    settings.load(...settings.siteDisabledKeys, sites[env.site].availFeatures)

    // Define MENU functions

    const toolbarMenu = {
        ids: [], state: {
            symbols: ['❌', '✔️'], separator: env.scriptManager.name == 'Tampermonkey' ? ' — ' : ': ',
            words: [app.msgs.state_off.toUpperCase(), app.msgs.state_on.toUpperCase()]
        },

        refresh() {
            if (typeof GM_unregisterMenuCommand == 'undefined') return
            for (const id of this.ids) { GM_unregisterMenuCommand(id) } this.register()
        },

        register() {

            // Show "Disabled (extension active)"
            if (env.extensionActive)
                GM_registerMenuCommand(`${this.state.symbols[0]} ${
                        toTitleCase(app.msgs.state_disabled)} (${app.msgs.menuLabel_extensionActive})`,
                    () => modals.open('about'), env.scriptManager.supportsTooltips ? { title: ' ' } : undefined )

            // ...or add settings toggles
            else {

                // Create toggles for available features if script not disabled via Site Settings
                if (!config[`${env.site}Disabled`]) Object.keys(settings.controls).forEach(key => {
                    if (sites[env.site].availFeatures.includes(key)) {
                        const menuLabel = `${ settings.controls[key].symbol
                                           || this.state.symbols[+settings.isEnabled(key)] } `
                                        + settings.controls[key].label
                                        + this.state.separator + this.state.words[+settings.isEnabled(key)]
                        this.ids.push(GM_registerMenuCommand(menuLabel, () => {
                            settings.save(key, !config[key]) ; sync.configToUI({ updatedKey: key })
                            notify(`${settings.controls[key].label}: ${
                                this.state.words[+(key.includes('Disabled') ^ config[key])]}`)
                        }, env.scriptManager.supportsTooltips ?
                            { title: settings.controls[key].helptip || ' ' } : undefined ))
                    }
                });

                // Create Site Settings
                const siteSettingsLabel = `🌐 ${settings.categories.siteSettings.label}`
                this.ids.push(GM_registerMenuCommand(siteSettingsLabel, () => {

                    // Show modal
                    const siteSettingsModal = modals.alert(siteSettingsLabel,
                        `<span style="font-size: 15px">${settings.categories.siteSettings.helptip}:</span><ul></ul>`,
                        null, null, 365
                    )

                    // Stylize toggles container
                    const siteSettingsUL = siteSettingsModal.querySelector('ul')
                    Object.assign(siteSettingsUL.style, { cursor: 'pointer', fontSize: '18px', margin: '16px 0 -15px',
                        minHeight: '100px', listStyle: 'none' })

                    // Create toggle per site
                    Object.keys(sites).forEach(site => {
                        const siteHomeURL = sites[site].urls.homepage.replace(/^https?:\/\//, '')

                        // Create/append item/label elems
                        const toggleRow = dom.create.elem('li', {
                            title: `${app.msgs.helptip_run} ${app.name} on ${siteHomeURL}`,
                            style: `
                                color: ${getTextColor()} ; /* based on config */
                                border-radius: 3px ; /* slightly round highlight strip */
                                transition: 0.1s ease ; /* for hover-zoom */
                                    -webkit-transition: 0.1s ease ; -moz-transition: 0.1s ease ;
                                    -o-transition: 0.1s ease ; -ms-transition: 0.1s ease`
                        })
                        const settingLabel = dom.create.elem('label', { style: 'cursor: pointer' })
                        settingLabel.textContent = siteHomeURL
                        toggleRow.append(settingLabel) ; siteSettingsUL.append(toggleRow)

                        // Init toggle input
                        const toggleInput = dom.create.elem('input',
                            { type: 'checkbox', disabled: true, style: 'display: none' })
                        toggleInput.checked = !config[`${site}Disabled`]

                        // Create/stylize switch
                        const switchSpan = dom.create.elem('span')
                        Object.assign(switchSpan.style, {
                            position: 'relative', left: '-1px', bottom:'-8.5px', float: 'right',
                            backgroundColor: '#ccc', width: '26px', height: '13px', borderRadius: '28px',
                            transition: '0.4s', '-webkit-transition': '0.4s', '-moz-transition': '0.4s',
                                '-o-transition': '0.4s', '-ms-transition': '0.4s'
                        })

                        // Create/stylize knob
                        const knobSpan = dom.create.elem('span')
                        Object.assign(knobSpan.style, {
                            position: 'absolute', left: '1px', bottom: '1px', content: '""',
                            backgroundColor: 'white', width: '11px', height: '11px', borderRadius: '28px',
                            transition: '0.2s', '-webkit-transition': '0.2s', '-moz-transition': '0.2s',
                                '-o-transition': '0.2s', '-ms-transition': '0.2s'
                        })

                        // Append elems
                        switchSpan.append(knobSpan) ; toggleRow.append(toggleInput, switchSpan)

                        // Update visual state w/ animation
                        setTimeout(() => updateStyles(toggleInput), 155)

                        // Add listeners
                        toggleRow.onmouseenter = () => Object.assign(toggleRow.style, {
                            padding: '4px 10px', transform: 'scale(1.15)',
                            background: 'rgba(100,149,237,0.88)', color: 'white'
                        })
                        toggleRow.onmouseleave = () => Object.assign(toggleRow.style, {
                            padding: '', transform: '', background: '', color: getTextColor() })
                        toggleRow.onclick = () => {
                            switchToggle(toggleInput)
                            settings.save(`${site}Disabled`, !config[`${site}Disabled`]) ; sync.configToUI()
                            if (env.site == site) // notify if setting of active site toggled
                                notify(`${app.name} 🧩 ${
                                    app.msgs[`state_${config[`${site}Disabled`] ? 'off' : 'on' }`].toUpperCase()}`)
                        }

                        function getTextColor() {
                            return config[`${site}Disabled`] ?
                                ( env.ui.scheme == 'dark' ? 'rgb(255,255,255,0.65)' : 'rgba(0,0,0,0.45)' ) // off
                              : ( env.ui.scheme == 'dark' ? 'rgb(255,255,255)' : 'rgba(0,0,0)' ) // on
                        }

                        function switchToggle(toggleInput) {
                            toggleInput.checked = !toggleInput.checked ; updateStyles(toggleInput) }

                        function updateStyles(toggleInput) { // toggle show + staggered switch animations in
                            requestAnimationFrame(() => {
                                switchSpan.style.backgroundColor = toggleInput.checked ? '#ad68ff' : '#ccc'
                                switchSpan.style.boxShadow = toggleInput.checked ? '2px 1px 9px #d8a9ff' : 'none'
                                knobSpan.style.transform = toggleInput.checked ?
                                    'translateX(14px) translateY(0)' : 'translateX(0)'
                                toggleRow.classList.toggle('active', toggleInput.checked) // dim/brighten entry
                            }) // to trigger 1st transition fx
                        }
                    })
                }, env.scriptManager.supportsTooltips ?
                    { title: settings.categories.siteSettings.helptip } : undefined ))
            }

            // Add About/Donate entries
            ['about', 'donate'].forEach(entryType => {
                if (entryType === 'donate' && env.extensionActive) return
                this.ids.push(GM_registerMenuCommand(
                    `${ entryType == 'about' ? '💡' : '💖' }`
                        + ` ${app.msgs[`menuLabel_${entryType}`]} ${ entryType == 'about' ? app.msgs.appName : '' }`,
                    () => modals.open(entryType), env.scriptManager.supportsTooltips ? { title: ' ' } : undefined
                ))
            })
        }
    }

    function updateCheck() {
        xhr({
            method: 'GET', url: app.urls.update + '?t=' + Date.now(),
            headers: { 'Cache-Control': 'no-cache' },
            onload: resp => {

                // Compare versions, alert if update found
                app.latestVer = /@version +(.*)/.exec(resp.responseText)?.[1]
                if (app.latestVer) for (let i = 0 ; i < 4 ; i++) { // loop thru subver's
                    const currentSubVer = parseInt(app.version.split('.')[i], 10) || 0,
                          latestSubVer = parseInt(app.latestVer.split('.')[i], 10) || 0
                    if (currentSubVer > latestSubVer) break // out of comparison since not outdated
                    else if (latestSubVer > currentSubVer) // if outdated
                        return modals.open('update', 'available')
                }

                // Alert to no update found, nav back to About
                modals.open('update', 'unavailable')
        }})
    }

    function toTitleCase(str) {
        if (!str) return ''
        const words = str.toLowerCase().split(' ')
        for (let i = 0 ; i < words.length ; i++) // for each word
            words[i] = words[i][0].toUpperCase() + words[i].slice(1) // title-case it
        return words.join(' ') // join'em back together
    }

    // Define FEEDBACK functions

    function notify(msg, pos = '', notifDuration = '', shadow = '') {
        if (config.notifDisabled && !new RegExp(`${app.msgs.menuLabel_modeNotifs}|🧩`).test(msg)) return

        // Strip state word to append colored one later
        const foundState = toolbarMenu.state.words.find(word => msg.includes(word))
        if (foundState) msg = msg.replace(foundState, '')

        // Show notification
        chatgpt.notify(`${app.symbol} ${msg}`, pos, notifDuration, shadow || env.ui.scheme == 'dark' ? '' : 'shadow')
        const notif = document.querySelector('.chatgpt-notif:last-child')

        // Append styled state word
        if (foundState) {
            const stateStyles = {
                on: {
                    light: 'color: #5cef48 ; text-shadow: rgba(255,250,169,0.38) 2px 1px 5px',
                    dark:  'color: #5cef48 ; text-shadow: rgb(55,255,0) 3px 0 10px'
                },
                off: {
                    light: 'color: #ef4848 ; text-shadow: rgba(255,169,225,0.44) 2px 1px 5px',
                    dark:  'color: #ef4848 ; text-shadow: rgba(255, 116, 116, 0.87) 3px 0 9px'
                }
            }
            const styledStateSpan = dom.create.elem('span')
            styledStateSpan.style.cssText = stateStyles[
                foundState == toolbarMenu.state.words[0] ? 'off' : 'on'][env.ui.scheme]
            styledStateSpan.append(foundState) ; notif.append(styledStateSpan)
        }
    }

    // Define UI functions

    function toggleMode(mode, state = '') {
        switch (state.toUpperCase()) {
            case 'ON' : activateMode(mode) ; break
            case 'OFF' : deactivateMode(mode) ; break
            default : ( mode == 'wideScreen' ? document.head.contains(wideScreenStyle)
                      : mode == 'fullWindow' ? ui.isFullWin() : chatgpt.isFullScreen() ) ? deactivateMode(mode)
                                                                                         : activateMode(mode)
        }

        function activateMode(mode) {
            if (mode == 'wideScreen') { document.head.append(wideScreenStyle) ; sync.mode('wideScreen') }
            else if (mode == 'fullWindow') {
                const selectors = sites[env.site].selectors,
                      sidebarToggle = document.querySelector(selectors.btns.sidebar)
                if (sidebarToggle) {
                    const sidebars = { left: document.querySelector(selectors.sidebar) }, sidebarsToHide = []
                    if (env.site === 'chatgpt') sidebars.right = document.querySelector(selectors.rightbar)
                    Object.entries(sidebars).forEach(([side, bar]) => // push fat/visible ones to hide
                        bar && dom.get.computedWidth(bar) > 100 && sidebarsToHide.push({ side, bar }))
                    sidebarsToHide.forEach(({ side, bar }) => { // hide'em
                        if (side == 'left') sidebarToggle.click() ; else bar.style.display = 'none' })
                } else { document.head.append(fullWinStyle) ; sync.mode('fullWindow') }
            } else if (mode == 'fullScreen') document.documentElement.requestFullscreen()
        }

        function deactivateMode(mode) {
            if (mode == 'wideScreen') { wideScreenStyle.remove() ; sync.mode('wideScreen') }
            else if (mode == 'fullWindow') {
                const selectors = sites[env.site].selectors,
                      sidebarToggle = document.querySelector(selectors.btns.sidebar)
                if (sidebarToggle) {
                    sidebarToggle.click()
                    if (env.site == 'chatgpt') {
                        const rightbar = document.querySelector(selectors.rightbar)
                        if (rightbar) rightbar.style.display = ''
                    }
                } else { fullWinStyle.remove() ; sync.mode('fullWindow') }
            } else if (mode == 'fullScreen') {
                if (config.f11) modals.alert(app.msgs.alert_pressF11, `${app.msgs.alert_f11reason}.`)
                else document.exitFullscreen().catch(
                    err => console.error(app.symbol + ' » Failed to exit fullscreen', err))
            }
        }
    }

    const tweaksStyle = dom.create.style() ; env.ui.hasTallChatbar = await chatbar.is.tall()
    buttons.import({ appName: app.name, env, sites, toggleMode, tweaksStyle })

    const update = {

        style: {

            chatbar() {
                chatbarStyle.innerText = (
                    env.site == 'chatgpt' ? ( config.widerChatbox ? ''
                          : `main form { max-width: ${chatbar.nativeWidth}px !important ; margin: auto }`
                    ) : env.site == 'perplexity' && config.wideScreen ?
                          `@media (min-width: 768px) {
                              div[class*=col-span-8]:has(${sites[env.site].selectors.input}) { width: 155% }}`
                      : env.site == 'poe' ? ( config.widerChatbox && config.wideScreen ?
                          '[class^=ChatPageMainFooter_footerInner] { width: 98% ; margin-right: 15px }' : ''
                    ) : ''
                )
            },

            tweaks() {
                const selectors = sites[env.site].selectors
                tweaksStyle.innerText = (
                    ( env.site == 'chatgpt' ?
                           `[id$=-btn]:hover { opacity: 100% !important } /* prevent chatbar btn dim on hover */
                            main { overflow: clip !important }` // prevent h-scrollbar...
                                // ...on sync.mode('fullWindow) => delayed chatbar.tweak()
                    : '' )
                  + ( config.tcbDisabled == false ? tcbStyle : '' ) // expand text input vertically
                  + ( config.hiddenHeader ? hhStyle : '' ) // hide header
                  + ( config.hiddenFooter ? hfStyle : '' ) // hide footer
                  + `#newChat-btn { display: ${ config.ncbDisabled == true ? 'none' : 'flex' }}`
                  + ( config.btnAnimationsDisabled ? '' : // zoom chatbar buttons on hover
                        `.${buttons.class} { will-change: transform } /* prevent wobble */
                         .${buttons.class}:hover { transform: scale(${ env.site == 'poe' ? 1.15 : 1.285 }) }` )
                  + ( config.blockSpamDisabled ? ''
                        : getAllSelectors(selectors.spam).join(',') + ' { display: none !important }' )
                )
                function getAllSelectors(obj) {
                    return Object.values(obj).flatMap(val => typeof val == 'object' ? getAllSelectors(val) : val) }
            },

            wideScreen() {
                wideScreenStyle.innerText = (
                    env.site == 'chatgpt' ?
                        '.text-base { max-width: 100% !important }' // widen outer container
                    : env.site == 'perplexity' ?
                       `div[class*=max-w-threadWidth] { max-width: 100% } /* widen limited containers */
                        .col-span-8 { width: 151% } /* widen inner-left container */
                        .col-span-4:has([data-icon=plus]) { display: none }` // hide right-bar
                    : env.site == 'poe' ?
                       `[class*=ChatMessagesView] { width: 100% !important } /* widen outer container */
                        [class^=Message] { max-width: 100% !important }` // widen speech bubbles
                  : '' )
            }
        }
    }

    const sync = {

        fullerWin() {
            if (config.fullWindow && config.fullerWindows && !config.wideScreen) { // activate fuller windows
                document.head.append(wideScreenStyle) ; buttons.update.svg('wideScreen', 'on')
            } else if (!config.fullWindow) { // de-activate fuller windows
                fullWinStyle.remove() // to remove style too so sidebar shows
                if (!config.wideScreen) { // disable widescreen if result of fuller window
                    wideScreenStyle.remove() ; buttons.update.svg('wideScreen', 'off')
            }}
        },

        mode(mode) { // setting + icon + tooltip + chatbar
            const state = ( mode == 'wideScreen' ? !!document.getElementById('wideScreen-mode')
                          : mode == 'fullWindow' ? ui.isFullWin()
                                                 : chatgpt.isFullScreen() )
            settings.save(mode, state) ; buttons.update.svg(mode) ; tooltip.update(mode)
            if (!config[`${env.site}Disabled`]) { // tweak UI
                if (mode == 'fullWindow') sync.fullerWin()
                if (env.site == 'chatgpt') setTimeout(() => chatbar.tweak(), // update inner width
                    mode == 'fullWindow' && ( config.wideScreen || config.fullerWindows )
                        && config.widerChatbox ? 111 : 0) // delay if toggled to/from active WCB to avoid wrong width
                else if (env.site == 'perplexity' || env.site == 'poe' && config.widerChatbox)
                    update.style.chatbar() // toggle full-width Perplexity chatbar or sync Poe WCB
                notify(`${app.msgs[`mode_${mode}`]} ${app.msgs[`state_${ state ? 'on' : 'off' }`].toUpperCase()}`)
            }
            config.modeSynced = true ; setTimeout(() => config.modeSynced = false, 100) // prevent repetition
        },

        configToUI(options) { // from toolbar menu toggles
            const scriptWasDisabled = !config[`${env.site}Disabled`]
            if (!scriptWasDisabled && config[`${env.site}Disabled`]) { // reset UI
                [wideScreenStyle, fullWinStyle, buttons].forEach(target => target.remove())
                tweaksStyle.innerText = '' ; chatbar.reset()
            } else if (!config[`${env.site}Disabled`]) { // sync modes/tweaks/btns
                if (config.wideScreen ^ document.head.contains(wideScreenStyle)) { // sync Widescreen
                    supressNotifs() ; toggleMode('wideScreen') }
                if (sites[env.site].hasSidebar) {
                    if (config.fullWindow ^ ui.isFullWin()) { // sync Full-Window
                        supressNotifs() ; toggleMode('fullWindow') }
                    sync.fullerWin() // sync Fuller Windows
                }
                update.style.tweaks() // sync TCB/NCB/HH/HF/BA
                update.style.chatbar() // sync WCB
                chatbar.tweak() // update ChatGPT chatbar inner width or hack other sites' button positions
                buttons.insert() // since .remove()'d when script disabled
                if (options?.updatedKey == 'btnAnimationsDisabled' && !config.btnAnimationsDisabled) // apply/remove fx
                    // ...to visually signal location + preview fx applied by Button Animations toggle-on
                    buttons.animate()
            }
            toolbarMenu.refresh() // to update state symbol/suffix + toggles visibility on site toggle

            function supressNotifs() {
                if (config.notifiedDisabled) return
                settings.save('notifDisabled', true) // suppress notifs for cleaner UI
                setTimeout(() => settings.save('notifDisabled', false), 55) // ...temporarily
            }
        }
    }

    chatgpt.canvasIsOpen = function() {
        return document.querySelector('section.popover')?.getBoundingClientRect().top == 0 }

    // Run MAIN routine

    // Init EXTENSION ACTIVE state
    postMessage({ action: 'getExtensionInfo', source: 'chatgpt-widescreen-mode.user.js' }, location.origin)
    addEventListener('message', handleMsgResp)
    function handleMsgResp(resp) {
        if (resp.origin != location.origin) return
        const sender = resp.data.source
        env.extensionActive = sender.includes(app.slug) && /extension/i.test(sender)
    }
    await new Promise(resolve => setTimeout(resolve, 100)) // wait for extension response
    removeEventListener('message', handleMsgResp)

    // Create browser TOOLBAR MENU + DISABLE SCRIPT if extension active
    toolbarMenu.register() ; if (env.extensionActive) return

    // Init UI props
    if (env.site == 'chatgpt') {
        sites[env.site].hasSidebar = !!await Promise.race([
            dom.get.loadedElem(sites.chatgpt.selectors.btns.sidebar), // DOM element if sidebar toggle loads
            dom.get.loadedElem(sites.chatgpt.selectors.btns.login).then(() => false), // null if login button loads
            new Promise(resolve => setTimeout(() => resolve(null), 3000)) // null if 3s passed
        ])
    }

    // Init FULL-MODE states
    config.fullScreen = chatgpt.isFullScreen()
    if (sites[env.site].selectors.btns.sidebar) // site has native FW state
         config.fullWindow = ui.isFullWin() // ...so match it
    else settings.load('fullWindow') // otherwise load CWM's saved state

    // Stylize ALERTS
    if (!document.getElementById('chatgpt-alert-override-style'))
        document.head.append(dom.create.style(
            env.ui.scheme == 'dark' ? '.chatgpt-modal > div { border: 1px solid white }' : '',
            { id: 'chatgpt-alert-override-style' }
        ))

    // Apply general style TWEAKS
    const tcbStyle = ( // heighten chatbox
              env.site == 'chatgpt' ? `div[class*=prose]:has(${sites[env.site].selectors.input})`
                                              : sites[env.site].selectors.input )
                   + '{ max-height: 68vh }'
    const hhStyle = sites[env.site].selectors.header + '{ display: none !important }' // hide header
                  + ( env.site == 'chatgpt' ? 'main { padding-top: 12px }' : '' ) // increase top-padding
    const hfStyle = `${sites[env.site].selectors.footer}${ // hide footer
        env.site === 'perplexity' ? `, ${sites[env.site].selectors.btns.help}` : '' } { display: none }`

    update.style.tweaks() ; document.head.append(tweaksStyle);

    // Add RISING PARTICLES styles
    ['rpg', 'rpw'].forEach(cssType => document.head.append(dom.create.style(GM_getResourceText(`${cssType}CSS`))))

    // Create WIDESCREEN style
    const wideScreenStyle = dom.create.style(null, { id: 'wideScreen-mode' })
    update.style.wideScreen()

    // Create FULL-WINDOW style
    const fullWinStyle = dom.create.style(
        sites[env.site].selectors.sidebar + '{ display: none }', { id: 'fullWindow-mode' })

    // Create/append CHATBAR style
    const chatbarStyle = dom.create.style()
    update.style.chatbar() ; document.head.append(chatbarStyle)

    // Insert BUTTONS/TOOLTIPS
    tooltip.createDiv() ; tooltip.stylize()
    if (!config[`${env.site}Disabled`]) {
        buttons.insert()

    // Restore PREV SESSION's state
        if (config.wideScreen) toggleMode('wideScreen', 'ON')
        if (config.fullWindow && sites[env.site].hasSidebar) {
            if (sites[env.site].selectors.btns.sidebar) // site has own FW config
                sync.mode('fullWindow') // ...so sync w/ it
            else toggleMode('fullWindow', 'on') // otherwise self-toggle
        }
    }

    // Monitor NODE CHANGES to maintain button visibility + update colors
    let isTempChat = false, canvasWasOpen = chatgpt.canvasIsOpen()
    new MutationObserver(() => {

        // Maintain button visibility on nav
        if (config[`${env.site}Disabled`]) return
        else if (!buttons.fullScreen?.isConnected && chatbar.get() && buttons.state.status != 'inserting') {
            buttons.state.status = 'missing' ; buttons.insert() }

        // Maintain button colors + Widescreen button visibility on snowflake chatgpt.com
        if (env.site == 'chatgpt') {

            // Update button colors on temp chat toggle
            const chatbarIsDark = chatbar.is.dark()
            if (chatbarIsDark != isTempChat) { buttons.update.color() ; isTempChat = chatbarIsDark }

            // Remove buttons on Canvas mode toggle-on
            if (canvasWasOpen ^ chatgpt.canvasIsOpen()) { buttons.remove() ; canvasWasOpen = !canvasWasOpen }
        }
    }).observe(document[env.site == 'poe' ? 'head' : 'body'], { attributes: true, subtree: true })

    // Monitor SCHEME PREF changes to update sidebar toggle + modal colors
    new MutationObserver(handleSchemePrefChange).observe( // for site scheme pref changes
        document.documentElement, { attributes: true, attributeFilter: ['class', 'data-color-scheme'] })
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener( // for browser/system scheme pref changes
        'change', () => requestAnimationFrame(handleSchemePrefChange))
    async function handleSchemePrefChange() {
        const displayedScheme = await ui.getScheme()
        if (env.ui.scheme != displayedScheme) {
            env.ui.scheme = displayedScheme ; modals.stylize() ; buttons.update.color() }
    }

    // Monitor SIDEBARS to update config.fullWindow for sites w/ native toggle
    if (sites[env.site].selectors.btns.sidebar && sites[env.site].hasSidebar) {
        const sidebarObserver = new ResizeObserver(() => // sync config.fullWindow ⇆ sidebar width
            (config.fullWindow ^ ui.isFullWin()) && !config.modeSynced && sync.mode('fullWindow'))
        observeSidebars()
        if (env.site == 'chatgpt') new MutationObserver( // re-observeSidebars() on disconnect
            () => getSidebars().some(bar => !sidebarObserver.targets?.includes(bar)) && observeSidebars()
        ).observe(document.body, { childList: true, subtree: true })

        function getSidebars() {
            const site = env.site, selectors = sites[site].selectors,
                  sidebars = [document.querySelector(selectors.sidebar)]
            if (site == 'chatgpt') sidebars.push(document.querySelector(selectors.rightbar))
            else if (site == 'perplexity') sidebars[0] = sidebars[0]?.parentNode
            return sidebars.filter(Boolean)
        }

        function observeSidebars() {
            const sidebars = getSidebars() ; if (!sidebars.length) return
            sidebarObserver.targets?.forEach(target => sidebarObserver.unobserve(target))
            sidebars.forEach(sidebar => sidebarObserver.observe(sidebar))
            sidebarObserver.targets = sidebars
        }
    }

    // Monitor PERPLEXITY NAV to update Attach File button alignment on delayed re-appearances
    if (env.site == 'perplexity') {
        let prevPath = location.pathname
        new MutationObserver(async () => { if (location.pathname != prevPath) {
            prevPath = location.pathname
            const attachFileBtn = await dom.get.loadedElem(sites.perplexity.selectors.btns.attachFile),
                  cwmActive = buttons.fullScreen.isConnected
            if (attachFileBtn['left-aligned'] ^ cwmActive) chatbar[cwmActive ? 'tweak' : 'reset']()
        }}).observe(document.body, { childList: true, subtree: true })
    }

    // Add RESIZE LISTENER to update full screen setting/button + disable F11 flag
    addEventListener('resize', () => {
        const fullScreenState = chatgpt.isFullScreen()
        if (config.fullScreen && !fullScreenState) { // exiting full screen
            sync.mode('fullScreen') ; config.f11 = false }
        else if (!config.fullScreen && fullScreenState) // entering full screen
            sync.mode('fullScreen')
        if (env.site == 'chatgpt') chatbar.tweak() // update ChatGPT chatbar inner width
    })

    // Add KEY LISTENER to enable flag on F11 + stop generating text on ESC
    document.addEventListener('keydown', event => {
        if ((event.key == 'F11' || event.keyCode == 122) && !config.fullScreen) config.f11 = true
        else if ((event.key.startsWith('Esc') || event.keyCode == 27) && chatgpt.isTyping())
            try { chatgpt.stop() ; requestAnimationFrame(() => !chatgpt.isTyping() &&
                      notify(app.msgs.notif_chatStopped, 'bottom-right')) } catch (err) {}
})

})()
